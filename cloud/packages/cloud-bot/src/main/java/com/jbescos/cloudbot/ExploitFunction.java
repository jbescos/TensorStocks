package com.jbescos.cloudbot;

import java.util.logging.Logger;

import com.google.cloud.functions.HttpFunction;
import com.google.cloud.functions.HttpRequest;
import com.google.cloud.functions.HttpResponse;
import com.jbescos.common.CloudProperties;
import com.jbescos.common.ExchangesExploitPrices;
import com.jbescos.common.StorageInfo;
import com.jbescos.exchange.Utils;

//Entry: com.jbescos.cloudbot.ExploitFunction
public class ExploitFunction implements HttpFunction {

    private static final Logger LOGGER = Logger.getLogger(ExploitFunction.class.getName());
    private static final String USER_ID_PARAM = "userId";

    @Override
    public void service(HttpRequest request, HttpResponse response) throws Exception {
        String userId = Utils.getParam(USER_ID_PARAM, null, request.getQueryParameters());
        if (userId == null || userId.isEmpty()) {
            throw new IllegalArgumentException(USER_ID_PARAM + " query parameter is mandatory");
        }
        StorageInfo storageInfo = StorageInfo.build();
        CloudProperties cloudProperties = new CloudProperties(userId, storageInfo);
        new ExchangesExploitPrices(cloudProperties).execute();
    }
}
